// File: app\labs\lab2\router.py
from typing import Annotated
from fastapi import APIRouter, Depends
from .schemas import P2Response, P2Request
from .services import UserService

router = APIRouter(prefix="/lab2", tags=["Lab2 - servicios inyectados"])

UserServiceDep = Annotated[UserService, Depends()]

@router.get(
    "/usuarios/{user_id}",
    response_model=P2Response
)
def get_user(user_id: int, service: UserServiceDep):
    """
    Retorna datos de un usuario con id indicado
    """
    return service.get_user(user_id)

@router.post(
    "/usuarios",
    response_model=P2Response
)
def create_user(req: P2Request, service: UserServiceDep):
    """
    Crea un nuevo usuario.
    """
    return service.create_user(req.name, req.email)



// File: app\labs\lab2\schemas.py
from pydantic import BaseModel, Field

class P2Request(BaseModel):
    name: str = Field(..., description="nombre de usuario", example="Fran")
    email: str = Field(..., description="email de usuario", example="francisco.aragon@example.com")

class P2Response(BaseModel):
    id: int = Field(..., description="id de usuario")
    name: str = Field(..., description="nombre de usuario")
    email: str = Field(..., description="email de usuario", example="francisco.aragon@example.com")  

// File: app\labs\lab2\services.py
from fastapi import HTTPException

class UserService:
    def __init__(self):
        self.users = {
            1: {"id": 1, "name": "Ana", "email": "ana@example.com"},
            2: {"id": 2, "name": "Luis", "email": "luis@example.com"}
        }
    
    def get_user(self, user_id: int) -> dict:
        """Lógica de negocio: buscar usuario por ID."""
        user = self.users.get(user_id)
        if not user:
            raise HTTPException(status_code=404, detail="Usuario no encontrado")
        return user
    
    def create_user(self, name: str, email: str) -> dict:
        """Lógica de negocio: validar y crear usuario."""
        if "@" not in email:
            raise HTTPException(status_code=400, detail="Email inválido")
        
        id = max(self.users.keys()) + 1
        new_user = {"id": id, "name": name, "email": email}
        self.users[id] = new_user
        return new_user
